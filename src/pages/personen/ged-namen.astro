---
import BaseLayout from "../../layouts/BaseLayout.astro";

export const chronik = {
  title: "Familiennamensliste",
  subtitle: "Einstieg in den Personen- und Familienbrowser",
  date: "2026-01-24",
  bereich: "Personen",
  href: "/personen/ged-namen",
  order: 20,
};
---

<BaseLayout title={chronik.title}>
  <article class="page ged-page">
    <header class="head">
      <h1>{chronik.title}</h1>
      <p class="subtitle">{chronik.subtitle}</p>
      <p class="meta">{chronik.date}</p>
    </header>

    <p>
      Diese Familiennamensliste bildet den Einstieg in den Personen- und
      Familienbrowser von Pechgrün. Über die Buchstabenleiste lassen sich alle
      in Pechgrün belegten Familiennamen auswählen; die Zahl hinter jedem Namen
      zeigt, wie viele Personen zu diesem Namen erfasst sind. Ein Klick führt zu
      den einzelnen Personen und von dort aus weiter zu ihren familiären
      Beziehungen – zu Ehepartnern, Kindern, Eltern und Geschwistern – und
      ermöglicht so einen zusammenhängenden Blick auf Lebenswege und
      Verwandtschaften in Pechgrün.
    </p>

    <div class="ged-namen">
      <div class="az" id="azBar"></div>
      <div class="meta" id="meta"></div>
      <div class="grid" id="surnameGrid"></div>
    </div>
  </article>

  <!-- IMPORTANT: global so dynamically injected <a> also match (no Astro scoping) -->
  <style is:global>
    /* --- page header --- */
    .ged-page .head {
      margin-bottom: 1.6rem; /* Header → Body */
    }

    .ged-page .head h1 {
      margin-bottom: 0.25rem; /* Titel → Subtitle */
    }

    .ged-page .head .subtitle {
      margin-top: 0;
      margin-bottom: 0.4rem; /* Subtitle → Meta */
      color: rgba(0, 0, 0, 0.65);
    }

    .ged-page .head .meta {
      margin: 0; /* Meta → nichts extra */
      font-size: 0.85rem;
      color: rgba(0, 0, 0, 0.45);
    }

    /* --- layout for this page --- */
    .ged-namen {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0.2rem 0 0.5rem 0; /* main padding is already in BaseLayout */
    }

    .ged-namen .az {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0.4rem 0 0.7rem 0;
    }

    .ged-namen .az button {
      border: 1px solid #bdbdbd;
      background: #f2f2f2;
      color: #111;
      padding: 3px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      line-height: 1.2;
    }

    .ged-namen .az button:hover {
      background: #e9e9e9;
    }

    .ged-namen .az button.active {
      background: #dcdcdc;
      border-color: #a8a8a8;
      font-weight: 600;
    }

    .ged-namen .meta {
      font-size: 13px;
      color: #555;
      margin: 0 0 0.6rem 0;
    }

    /* 3-column grid – compact columns, list-style rows */
    .ged-namen .grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      column-gap: 14px; /* <<< Spalten dichter */
      row-gap: 0px; /* Zeilenabstand bleibt angenehm */
    }

    @media (max-width: 900px) {
      .ged-namen .grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 560px) {
      .ged-namen .grid {
        grid-template-columns: 1fr;
      }
    }

    /* remove card look entirely */
    .ged-namen .nameRow {
      border: none;
      border-radius: 0;
      padding: 0;
      background: transparent;
    }

    .ged-namen .nameRow:hover {
      background: transparent;
    }

    /* keep link styling: black, no underline; but behave like plain list text */
    .ged-namen a.nameLink,
    .ged-namen a.nameLink:visited,
    .ged-namen a.nameLink:hover,
    .ged-namen a.nameLink:active {
      color: #111 !important;
      text-decoration: none !important;
      border-bottom: none !important;
      box-shadow: none !important;
      line-height: 1;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    /* optional: tiny hover feedback without changing layout */
    .ged-namen a.nameLink:hover {
      opacity: 0.75;
    }

    .ged-namen .count {
      color: rgba(0, 0, 0, 0.55);
      font-weight: 400;
      font-size: 0.92em;
    }
  </style>

  <script type="module">
    const DATA_BASE = "/data/ged";
    const $ = (id) => document.getElementById(id);

    const LETTERS = [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J",
      "K",
      "L",
      "M",
      "N",
      "O",
      "P",
      "Q",
      "R",
      "S",
      "T",
      "U",
      "V",
      "W",
      "X",
      "Y",
      "Z",
      "…",
    ];

    const state = {
      surnames: [],
      surnameToPersons: {},
      currentLetter: "A",
    };

    function qsGet(key) {
      return new URL(location.href).searchParams.get(key);
    }

    function qsSet(key, val) {
      const u = new URL(location.href);
      if (val == null) u.searchParams.delete(key);
      else u.searchParams.set(key, val);
      history.pushState({}, "", u);
    }

    function surnameDisplay(sn) {
      if (!sn || sn === "(UNKNOWN)") return "…";
      return sn;
    }

    function firstLetter(sn) {
      const disp = surnameDisplay(sn);
      const ch = (disp[0] || "…").toUpperCase();
      if (LETTERS.includes(ch)) return ch;
      return "…";
    }

    function renderAz() {
      const bar = $("azBar");
      bar.innerHTML = "";

      for (const L of LETTERS) {
        const b = document.createElement("button");
        b.textContent = L;
        if (L === state.currentLetter) b.classList.add("active");
        b.onclick = () => {
          state.currentLetter = L;
          qsSet("az", L);
          renderAz();
          renderGrid();
        };
        bar.appendChild(b);
      }
    }

    function renderGrid() {
      const grid = $("surnameGrid");
      grid.innerHTML = "";

      const filtered = state.surnames.filter(
        (sn) => firstLetter(sn) === state.currentLetter
      );

      $("meta").textContent = filtered.length
        ? `${filtered.length} Familiennamen unter „${state.currentLetter}“`
        : `Keine Familiennamen unter „${state.currentLetter}“`;

      for (const sn of filtered) {
        const ids = state.surnameToPersons[sn] || [];
        const href = `/internal/ged-liste?sn=${encodeURIComponent(sn)}&az=${encodeURIComponent(state.currentLetter)}`;

        const row = document.createElement("div");
        row.className = "nameRow";
        row.innerHTML = `
          <a class="nameLink" href="${href}" data-astro-reload>
            ${surnameDisplay(sn)} <span class="count">(${ids.length})</span>
          </a>
        `;
        grid.appendChild(row);
      }
    }

    async function loadAll() {
      const [surnames, surnameToPersons] = await Promise.all([
        fetch(`${DATA_BASE}/surnames.json`).then((r) => r.json()),
        fetch(`${DATA_BASE}/surnameToPersons.json`).then((r) => r.json()),
      ]);

      state.surnames = surnames;
      state.surnameToPersons = surnameToPersons;

      const az = qsGet("az");
      state.currentLetter = az && LETTERS.includes(az) ? az : "A";

      renderAz();
      renderGrid();
    }

    window.onpopstate = () => {
      const az = qsGet("az");
      state.currentLetter = az && LETTERS.includes(az) ? az : "A";
      renderAz();
      renderGrid();
    };

    loadAll().catch((err) => {
      console.error(err);
      $("meta").textContent = String(err);
    });
  </script>
  
</BaseLayout>

